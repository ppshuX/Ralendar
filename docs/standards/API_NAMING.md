# ğŸŒ Roamio å¤§å®¶æ— - API å‘½åè§„èŒƒ

> **ç‰ˆæœ¬**: v1.0  
> **æ›´æ–°æ—¥æœŸ**: 2025-11-09  
> **é€‚ç”¨èŒƒå›´**: æ‰€æœ‰åç«¯ API å¼€å‘

---

## ğŸ“‹ ç›®å½•

1. [RESTful è·¯ç”±è§„åˆ™](#restful-è·¯ç”±è§„åˆ™)
2. [URL å‘½åè§„èŒƒ](#url-å‘½åè§„èŒƒ)
3. [HTTP æ–¹æ³•ä½¿ç”¨](#http-æ–¹æ³•ä½¿ç”¨)
4. [è¯·æ±‚å’Œå“åº”æ ¼å¼](#è¯·æ±‚å’Œå“åº”æ ¼å¼)
5. [é”™è¯¯ç ä½“ç³»](#é”™è¯¯ç ä½“ç³»)
6. [ç‰ˆæœ¬ç®¡ç†](#ç‰ˆæœ¬ç®¡ç†)

---

## ğŸ¯ RESTful è·¯ç”±è§„åˆ™

### **èµ„æºå‘½ååŸåˆ™**

1. **ä½¿ç”¨å¤æ•°åè¯**ï¼ˆä¸æ˜¯åŠ¨è¯ï¼‰
2. **ä½¿ç”¨å°å†™å’Œè¿å­—ç¬¦**ï¼ˆä¸æ˜¯ä¸‹åˆ’çº¿æˆ–é©¼å³°ï¼‰
3. **å±‚çº§æ¸…æ™°**

### **æ ‡å‡†ç¤ºä¾‹**

âœ… **æ­£ç¡®**:
```
GET    /api/v1/events/              # è·å–äº‹ä»¶åˆ—è¡¨
POST   /api/v1/events/              # åˆ›å»ºäº‹ä»¶
GET    /api/v1/events/123/          # è·å–å•ä¸ªäº‹ä»¶
PUT    /api/v1/events/123/          # æ›´æ–°äº‹ä»¶
DELETE /api/v1/events/123/          # åˆ é™¤äº‹ä»¶

GET    /api/v1/users/456/events/   # è·å–ç”¨æˆ·çš„äº‹ä»¶
```

âŒ **é”™è¯¯**:
```
GET    /api/v1/getEvents/           # ä¸è¦ä½¿ç”¨åŠ¨è¯
POST   /api/v1/event/create/        # ä¸è¦ä½¿ç”¨åŠ¨è¯
GET    /api/v1/Events/              # ä¸è¦å¤§å†™
GET    /api/v1/user_events/         # ä¸è¦ä¸‹åˆ’çº¿
DELETE /api/v1/events/123/delete/   # ä¸è¦å¤šä½™çš„ /delete/
```

---

## ğŸ”— URL å‘½åè§„èŒƒ

### **åŸºç¡€ç»“æ„**

```
https://{domain}/api/{version}/{resource}/{id}/{sub-resource}/
```

**ç¤ºä¾‹è§£æï¼š**
```
https://app7626.acapp.acwing.com.cn/api/v1/trips/events/
â”‚                                    â”‚   â”‚  â”‚     â”‚
â”‚                                    â”‚   â”‚  â”‚     â””â”€ èµ„æºï¼ˆå¤æ•°ï¼‰
â”‚                                    â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€ å‘½åç©ºé—´ï¼ˆå¯é€‰ï¼‰
â”‚                                    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ç‰ˆæœ¬å·
â”‚                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ å›ºå®šå‰ç¼€
```

### **å¸¸è§ URL æ¨¡å¼**

| åœºæ™¯ | URL æ¨¡å¼ | ç¤ºä¾‹ |
|------|----------|------|
| åˆ—è¡¨ | `GET /{resource}/` | `/api/v1/events/` |
| è¯¦æƒ… | `GET /{resource}/{id}/` | `/api/v1/events/123/` |
| åˆ›å»º | `POST /{resource}/` | `/api/v1/events/` |
| æ›´æ–° | `PUT /{resource}/{id}/` | `/api/v1/events/123/` |
| åˆ é™¤ | `DELETE /{resource}/{id}/` | `/api/v1/events/123/` |
| å­èµ„æº | `GET /{resource}/{id}/{sub}/` | `/api/v1/users/1/events/` |
| æ‰¹é‡æ“ä½œ | `POST /{resource}/batch/` | `/api/v1/events/batch/` |
| è‡ªå®šä¹‰æ“ä½œ | `POST /{resource}/{id}/{action}/` | `/api/v1/events/123/complete/` |

---

## ğŸ”¨ HTTP æ–¹æ³•ä½¿ç”¨

### **æ ‡å‡† CRUD æ˜ å°„**

| HTTP æ–¹æ³• | æ“ä½œ | æ˜¯å¦å¹‚ç­‰ | ç¤ºä¾‹ |
|-----------|------|----------|------|
| `GET` | è¯»å–ï¼ˆæŸ¥è¯¢ï¼‰ | âœ… æ˜¯ | è·å–äº‹ä»¶åˆ—è¡¨ |
| `POST` | åˆ›å»º | âŒ å¦ | åˆ›å»ºæ–°äº‹ä»¶ |
| `PUT` | å®Œæ•´æ›´æ–° | âœ… æ˜¯ | æ›´æ–°æ•´ä¸ªäº‹ä»¶ |
| `PATCH` | éƒ¨åˆ†æ›´æ–° | âœ… æ˜¯ | åªæ›´æ–°æ ‡é¢˜ |
| `DELETE` | åˆ é™¤ | âœ… æ˜¯ | åˆ é™¤äº‹ä»¶ |

### **ä½¿ç”¨åŸåˆ™**

1. **GET è¯·æ±‚ä¸åº”æœ‰å‰¯ä½œç”¨**ï¼ˆä¸ä¿®æ”¹æ•°æ®ï¼‰
2. **POST ç”¨äºåˆ›å»ºå’Œéå¹‚ç­‰æ“ä½œ**
3. **PUT ç”¨äºå®Œæ•´æ›¿æ¢**
4. **PATCH ç”¨äºéƒ¨åˆ†æ›´æ–°**
5. **DELETE ç”¨äºåˆ é™¤èµ„æº**

### **ç‰¹æ®Šæƒ…å†µ**

**æ‰¹é‡æ“ä½œï¼š**
```http
POST /api/v1/events/batch/
Content-Type: application/json

{
  "events": [
    {"title": "äº‹ä»¶1", ...},
    {"title": "äº‹ä»¶2", ...}
  ]
}
```

**è‡ªå®šä¹‰æ“ä½œï¼š**
```http
POST /api/v1/events/123/complete/   # æ ‡è®°å®Œæˆ
POST /api/v1/events/123/share/      # åˆ†äº«
```

---

## ğŸ“¦ è¯·æ±‚å’Œå“åº”æ ¼å¼

### **è¯·æ±‚ Bodyï¼ˆJSONï¼‰**

```json
{
  "title": "ä¼šè®®",
  "description": "é¡¹ç›®è®¨è®º",
  "start_time": "2025-11-10T14:00:00Z",
  "end_time": "2025-11-10T15:00:00Z",
  "location": "ä¼šè®®å®¤A",
  "reminder_minutes": 15,
  "email_reminder": true
}
```

**å­—æ®µå‘½åè§„åˆ™ï¼š**
- ä½¿ç”¨ `snake_case`ï¼ˆä¸æ˜¯ camelCaseï¼‰
- å¸ƒå°”å€¼ç”¨ `is_` æˆ–ç›´æ¥ç”¨å½¢å®¹è¯ï¼ˆå¦‚ `email_reminder`ï¼‰
- æ—¶é—´å­—æ®µç»Ÿä¸€ç”¨ ISO 8601 æ ¼å¼ï¼ˆUTCï¼‰

### **æˆåŠŸå“åº”**

**å•ä¸ªèµ„æºï¼š**
```json
{
  "id": 123,
  "title": "ä¼šè®®",
  "created_at": "2025-11-09T10:00:00Z",
  "updated_at": "2025-11-09T10:00:00Z"
}
```

**åˆ—è¡¨èµ„æºï¼š**
```json
{
  "count": 100,
  "next": "/api/v1/events/?page=2",
  "previous": null,
  "results": [
    {"id": 1, "title": "äº‹ä»¶1"},
    {"id": 2, "title": "äº‹ä»¶2"}
  ]
}
```

### **é”™è¯¯å“åº”**

```json
{
  "error": "äº‹ä»¶æœªæ‰¾åˆ°",
  "code": "EVENT_NOT_FOUND",
  "details": {
    "event_id": 999
  }
}
```

---

## âš ï¸ é”™è¯¯ç ä½“ç³»

### **HTTP çŠ¶æ€ç ä½¿ç”¨**

| çŠ¶æ€ç  | åœºæ™¯ | ç¤ºä¾‹ |
|--------|------|------|
| `200 OK` | æˆåŠŸï¼ˆGET/PUT/PATCHï¼‰ | è·å–äº‹ä»¶æˆåŠŸ |
| `201 Created` | åˆ›å»ºæˆåŠŸï¼ˆPOSTï¼‰ | äº‹ä»¶åˆ›å»ºæˆåŠŸ |
| `204 No Content` | åˆ é™¤æˆåŠŸï¼ˆDELETEï¼‰ | äº‹ä»¶åˆ é™¤æˆåŠŸ |
| `400 Bad Request` | è¯·æ±‚å‚æ•°é”™è¯¯ | ç¼ºå°‘å¿…å¡«å­—æ®µ |
| `401 Unauthorized` | æœªè®¤è¯ | Token æ— æ•ˆ |
| `403 Forbidden` | æ— æƒé™ | ä¸èƒ½åˆ é™¤ä»–äººäº‹ä»¶ |
| `404 Not Found` | èµ„æºä¸å­˜åœ¨ | äº‹ä»¶ ID ä¸å­˜åœ¨ |
| `500 Internal Server Error` | æœåŠ¡å™¨é”™è¯¯ | æ•°æ®åº“è¿æ¥å¤±è´¥ |

### **è‡ªå®šä¹‰é”™è¯¯ç **

**æ ¼å¼ï¼š** `{RESOURCE}_{ACTION}_{REASON}`

**ç¤ºä¾‹ï¼š**
```
EVENT_CREATE_INVALID_TIME    # äº‹ä»¶åˆ›å»ºå¤±è´¥ï¼šæ—¶é—´æ— æ•ˆ
EVENT_UPDATE_NOT_FOUND       # äº‹ä»¶æ›´æ–°å¤±è´¥ï¼šæœªæ‰¾åˆ°
EVENT_DELETE_PERMISSION      # äº‹ä»¶åˆ é™¤å¤±è´¥ï¼šæ— æƒé™
USER_LOGIN_INVALID_TOKEN     # ç”¨æˆ·ç™»å½•å¤±è´¥ï¼šToken æ— æ•ˆ
```

**å®Œæ•´é”™è¯¯å“åº”ï¼š**
```json
{
  "error": "äº‹ä»¶åˆ›å»ºå¤±è´¥ï¼šå¼€å§‹æ—¶é—´ä¸èƒ½æ™šäºç»“æŸæ—¶é—´",
  "code": "EVENT_CREATE_INVALID_TIME",
  "status": 400,
  "details": {
    "start_time": "2025-11-10T15:00:00Z",
    "end_time": "2025-11-10T14:00:00Z"
  },
  "timestamp": "2025-11-09T10:30:00Z"
}
```

---

## ğŸ“Œ ç‰ˆæœ¬ç®¡ç†

### **URL ç‰ˆæœ¬ï¼ˆæ¨èï¼‰**

```
/api/v1/events/    # ç‰ˆæœ¬ 1
/api/v2/events/    # ç‰ˆæœ¬ 2
```

### **ç‰ˆæœ¬æ›´æ–°ç­–ç•¥**

1. **v1 â†’ v2**: ä¸å…¼å®¹çš„é‡å¤§å˜æ›´
2. **v1.1 â†’ v1.2**: å‘åå…¼å®¹çš„æ–°å¢åŠŸèƒ½ï¼ˆå¯é€‰ï¼Œé€šå¸¸ä¸ä½“ç°åœ¨ URLï¼‰

### **åºŸå¼ƒç­–ç•¥**

```json
{
  "deprecated": true,
  "deprecation_date": "2026-01-01",
  "new_version": "/api/v2/events/",
  "message": "æ­¤æ¥å£å°†äº 2026-01-01 ä¸‹çº¿ï¼Œè¯·è¿ç§»åˆ° v2"
}
```

---

## ğŸ¯ å‘½åç©ºé—´ï¼ˆNamespaceï¼‰

### **æ¨èä½¿ç”¨å‘½åç©ºé—´æ¥ç»„ç»‡ API**

```
/api/v1/auth/login/              # è®¤è¯ç›¸å…³
/api/v1/auth/logout/
/api/v1/auth/refresh/

/api/v1/ralendar/events/         # Ralendar ç›¸å…³
/api/v1/ralendar/trips/events/

/api/v1/roamio/notes/            # Roamio ç›¸å…³
/api/v1/roamio/tasks/

/api/v1/fusion/events/           # è·¨åº”ç”¨é›†æˆ
/api/v1/fusion/sync/
```

**ä¼˜åŠ¿ï¼š**
- æ¸…æ™°çš„åŠŸèƒ½åˆ’åˆ†
- é¿å… URL å†²çª
- æ–¹ä¾¿æƒé™ç®¡ç†

---

## âœ… æ£€æŸ¥æ¸…å•

å¼€å‘æ–° API æ—¶ï¼Œç¡®è®¤ï¼š

- [ ] URL ä½¿ç”¨å¤æ•°åè¯ï¼ˆ`/events/` ä¸æ˜¯ `/event/`ï¼‰
- [ ] éµå¾ª RESTful è§„èŒƒï¼ˆ`GET` æŸ¥è¯¢ï¼Œ`POST` åˆ›å»ºï¼Œ`PUT` æ›´æ–°ï¼Œ`DELETE` åˆ é™¤ï¼‰
- [ ] å­—æ®µä½¿ç”¨ `snake_case`
- [ ] æ—¶é—´ä½¿ç”¨ ISO 8601 æ ¼å¼ï¼ˆUTCï¼‰
- [ ] é”™è¯¯å“åº”åŒ…å« `error`, `code`, `details`
- [ ] HTTP çŠ¶æ€ç ä½¿ç”¨æ­£ç¡®
- [ ] æœ‰ç‰ˆæœ¬å·ï¼ˆ`/api/v1/`ï¼‰

---

## ğŸ“š å‚è€ƒèµ„æ–™

- [RESTful API Design Best Practices](https://restfulapi.net/)
- [Django REST Framework](https://www.django-rest-framework.org/)

---

## ğŸ“ æ›´æ–°æ—¥å¿—

### v1.0 (2025-11-09)
- åˆå§‹ç‰ˆæœ¬
- åŸºäº Ralendar + Roamio å®è·µç»éªŒæ•´ç†

