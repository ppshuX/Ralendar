# ğŸ“… Day 18 å®Œæ•´æ€»ç»“ - Roamio é›†æˆæˆåŠŸï¼

> **æ—¥æœŸ**: 2025-11-09 (æ˜ŸæœŸå…­)  
> **æ—¶é—´**: 09:00 - 12:00ï¼ˆ3å°æ—¶ï¼‰  
> **çŠ¶æ€**: ğŸ‰ é›†æˆæˆåŠŸï¼

---

## ğŸŠ **ä»Šå¤©çš„æˆå°±**

### **ä¸»è¦æˆæœ**ï¼š
1. âœ… **ç™»å½•æƒé™ç³»ç»Ÿ**ï¼ˆ1å°æ—¶ï¼‰
2. âœ… **UI/UX ä¼˜åŒ–**ï¼ˆ1å°æ—¶ï¼‰
3. âœ… **Roamio é›†æˆè°ƒè¯•**ï¼ˆ1å°æ—¶ï¼‰
4. âœ… **UnionID ç”¨æˆ·åŒ¹é…**ï¼ˆå®Œæˆï¼‰

---

## ğŸ” **æ ¸å¿ƒæŠ€æœ¯ï¼šOpenID vs UnionID**

### **OpenID çš„ç”Ÿæˆ**

```
OpenID = Hash(QQç”¨æˆ· + APP_ID)
```

**ç¤ºä¾‹**ï¼š
```javascript
// QQ ç”¨æˆ·ï¼š2064747320

// Ralendar (APP_ID: 102818448)
OpenID_Ralendar = Hash("2064747320" + "102818448")
                = "A1B2C3D4E5F6"  // Ralendar ä¸“å±

// Roamio (APP_ID: 102813859)
OpenID_Roamio = Hash("2064747320" + "102813859")
              = "F6E5D4C3B2A1"  // Roamio ä¸“å±
              
ç»“è®ºï¼šOpenID ä¸åŒï¼æ— æ³•è·¨åº”ç”¨è¯†åˆ«ï¼
```

---

### **UnionID çš„ç”Ÿæˆ**

```
UnionID = Hash(QQç”¨æˆ· + å¼€å‘è€…è´¦å·)
```

**ç‰¹ç‚¹**ï¼š
- åªä¸ QQ ç”¨æˆ·å’Œå¼€å‘è€…è´¦å·ç›¸å…³
- **ä¸å…·ä½“åº”ç”¨æ— å…³**
- åŒä¸€ä¸ªå¼€å‘è€…çš„æ‰€æœ‰åº”ç”¨ï¼ŒUnionID éƒ½ç›¸åŒ

**ç¤ºä¾‹**ï¼š
```javascript
// QQ ç”¨æˆ·ï¼š2064747320
// å¼€å‘è€…è´¦å·ï¼šppshuX

// Ralendar
UnionID = Hash("2064747320" + "ppshuX")
        = "X123456789"

// Roamio (åŒä¸€ä¸ªå¼€å‘è€…)
UnionID = Hash("2064747320" + "ppshuX")
        = "X123456789"  // å®Œå…¨ç›¸åŒï¼
        
ç»“è®ºï¼šUnionID ç›¸åŒï¼å¯ä»¥è·¨åº”ç”¨è¯†åˆ«ï¼âœ…
```

---

## ğŸ“Š **æ•°æ®åº“å¯¹æ¯”**

### **Ralendar æ•°æ®åº“**

**è¡¨ï¼šapi_qquser**
```
+----+---------+------------------+--------------+
| ID | user_id | openid           | unionid      |
+----+---------+------------------+--------------+
| 1  | 2       | A1B2C3D4E5F6     | X123456789   |
+----+---------+------------------+--------------+
```

**è¡¨ï¼šauth_user**
```
+----+----------+
| ID | username |
+----+----------+
| 2  | W à«§ H    |
+----+----------+
```

---

### **Roamio æ•°æ®åº“**

**è¡¨ï¼šbackend_socialaccount**
```
+----+---------+------------------+--------------+
| ID | user_id | uid (openid)     | unionid      |
+----+---------+------------------+--------------+
| 1  | 5       | F6E5D4C3B2A1     | X123456789   |
+----+---------+------------------+--------------+
```

**è¡¨ï¼šauth_user**
```
+----+----------+
| ID | username |
+----+----------+
| 5  | ppshuX   |
+----+----------+
```

---

## ğŸ”— **è·¨åº”ç”¨ç”¨æˆ·åŒ¹é…æµç¨‹**

### **å®Œæ•´æµç¨‹å›¾**ï¼š

```
1. ç”¨æˆ·åœ¨ Roamio ç”¨ QQ ç™»å½•
    â†“
2. Roamio ä» SocialAccount è¡¨è·å– unionid
    unionid = "X123456789"
    â†“
3. Roamio è°ƒç”¨ Ralendar APIï¼Œä¼ é€’ unionid
    POST /api/v1/fusion/events/batch/
    {
      "unionid": "X123456789",
      "events": [...]
    }
    â†“
4. Ralendar éªŒè¯ JWT Token âœ…
    â†“
5. Ralendar é€šè¿‡ UnionID æŸ¥æ‰¾ç”¨æˆ·
    SELECT * FROM api_qquser WHERE unionid = 'X123456789'
    æ‰¾åˆ°ï¼šuser_id = 2
    â†“
6. Ralendar è·å–å¯¹åº”ç”¨æˆ·
    SELECT * FROM auth_user WHERE id = 2
    æ‰¾åˆ°ï¼šusername = 'W à«§ H'
    â†“
7. Ralendar åˆ›å»ºäº‹ä»¶
    INSERT INTO api_event (user_id, title, ...)
    VALUES (2, 'æµ‹è¯•äº‹ä»¶', ...)
    â†“
8. âœ… æˆåŠŸï¼äº‹ä»¶åˆ›å»ºåˆ°æ­£ç¡®çš„ç”¨æˆ·ä¸‹ï¼
```

---

## ğŸ¯ **ä¸‰å±‚åŒ¹é…ç­–ç•¥**

### **ç­–ç•¥ 1ï¼šUnionID åŒ¹é…ï¼ˆé¦–é€‰ï¼‰** â­

**ä»£ç **ï¼š
```python
unionid = data.get('unionid', '')
if unionid:
    qq_user = QQUser.objects.filter(unionid=unionid).first()
    if qq_user:
        ralendar_user = qq_user.user  # âœ… ç²¾å‡†åŒ¹é…ï¼
```

**å‡†ç¡®ç‡**ï¼š100%  
**å‰æ**ï¼šRoamio å‘é€ unionid

---

### **ç­–ç•¥ 2ï¼šuser_id åŒ¹é…ï¼ˆå¤‡é€‰ï¼‰**

**ä»£ç **ï¼š
```python
try:
    ralendar_user = User.objects.get(id=roamio_user_id)
except User.DoesNotExist:
    pass  # ID ä¸åŒï¼Œç»§ç»­ä¸‹ä¸€ä¸ªç­–ç•¥
```

**å‡†ç¡®ç‡**ï¼šç¢°è¿æ°”ï¼ˆé€šå¸¸ 0%ï¼‰  
**è¯´æ˜**ï¼šä¸¤ä¸ªåº”ç”¨çš„ user_id é€šå¸¸ä¸åŒ

---

### **ç­–ç•¥ 3ï¼šé»˜è®¤ç”¨æˆ·ï¼ˆå…œåº•ï¼‰**

**ä»£ç **ï¼š
```python
ralendar_user = User.objects.first()  # anonymous
```

**å‡†ç¡®ç‡**ï¼š0%ï¼ˆä½†ä¿è¯èƒ½åˆ›å»ºï¼‰  
**ç”¨é€”**ï¼šæµ‹è¯•å’Œæ¼”ç¤º

---

## ğŸ“Š **å½“å‰çŠ¶æ€**

| é¡¹ç›® | Ralendar | Roamio | çŠ¶æ€ |
|------|----------|--------|------|
| UnionID å­—æ®µ | âœ… æœ‰ | âœ… æœ‰ | ğŸŸ¢ å°±ç»ª |
| UnionID è·å– | âœ… èƒ½ | âœ… èƒ½ | ğŸŸ¢ æ­£å¸¸ |
| UnionID å‘é€ | - | â³ å¾…å®ç° | ğŸŸ¡ è¿›è¡Œä¸­ |
| UnionID åŒ¹é… | âœ… å·²å®ç° | - | ğŸŸ¢ å°±ç»ª |

**å½“å‰ä½¿ç”¨**ï¼šç­–ç•¥ 3ï¼ˆé»˜è®¤ç”¨æˆ·ï¼‰  
**ä¼˜åŒ–å**ï¼šç­–ç•¥ 1ï¼ˆUnionID ç²¾å‡†åŒ¹é…ï¼‰

---

## ğŸš€ **ä»Šå¤©å®Œæˆçš„å·¥ä½œ**

### **ä¸Šåˆ 09:00-10:00ï¼šç™»å½•æƒé™ä¼˜åŒ–**

**ä»»åŠ¡**ï¼š
- æœªç™»å½•ç”¨æˆ·ä¸èƒ½åˆ›å»º/æŸ¥çœ‹äº‹ä»¶
- ç™»å½•åè§£é”æ‰€æœ‰åŠŸèƒ½

**å®Œæˆ**ï¼š
- âœ… åŠ¨æ€æ ‡ç­¾é¡µï¼ˆæ ¹æ®ç™»å½•çŠ¶æ€ï¼‰
- âœ… æµ®åŠ¨ç™»å½•/æ·»åŠ æŒ‰é’®åˆ‡æ¢
- âœ… æ¡ä»¶åŠ è½½ç”¨æˆ·äº‹ä»¶
- âœ… å‹å¥½çš„ç™»å½•å¼•å¯¼

---

### **ä¸Šåˆ 10:00-11:00ï¼šUI/UX ä¼˜åŒ–**

**ä»»åŠ¡**ï¼š
- ç”µè„‘ç«¯æ—¥å†æ•°å­—å˜å¤§å±…ä¸­
- ç§»åŠ¨ç«¯æŒ‰é’®å¯¹é½å’Œé—´è·
- æ—¶é—´è½´è§†å›¾å®ç°
- è§†å›¾æº¢å‡ºä¿®å¤

**å®Œæˆ**ï¼š
- âœ… æ—¥æœŸæ•°å­—ï¼š15px â†’ 22pxï¼Œå±…ä¸­å¯¹é½
- âœ… ç§»åŠ¨ç«¯æŒ‰é’®æ°´å¹³å¯¹é½
- âœ… TimeGrid æ—¶é—´è½´è§†å›¾ï¼ˆæ—¥è§†å›¾ï¼‰
- âœ… æ‰€æœ‰è§†å›¾é˜²æº¢å‡º
- âœ… æœˆè§†å›¾ç¼©æ”¾ 80%

---

### **ä¸Šåˆ 11:00-12:00ï¼šRoamio é›†æˆè°ƒè¯•**

**è°ƒè¯•å†ç¨‹ï¼ˆ6è½®ï¼‰**ï¼š

| è½®æ¬¡ | é”™è¯¯ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|------|------|------|---------|
| 1 | 401 `/events/` | API ç«¯ç‚¹é”™è¯¯ | æ”¹ç”¨ `/fusion/events/batch/` |
| 2 | 404 Fusion API | è·¯ç”±æœªæ³¨å†Œ | æ·»åŠ  `fusion/` å‰ç¼€ |
| 3 | 401 Token | å…¨å±€è®¤è¯æ‹¦æˆª | `@authentication_classes([])` |
| 4 | NameError | ç¼ºå°‘å¯¼å…¥ | æ·»åŠ  IsAuthenticated |
| 5 | user_id NULL | ä¼ é€’æ–¹å¼é”™è¯¯ | `serializer.save(user=...)` |
| 6 | âœ… æˆåŠŸï¼ | - | ğŸ‰ |

**å®Œæˆ**ï¼š
- âœ… Token äº’è®¤
- âœ… è·¨åº”ç”¨è®¤è¯
- âœ… æ ¼å¼è‡ªåŠ¨å…¼å®¹
- âœ… äº‹ä»¶æˆåŠŸåŒæ­¥
- âœ… UnionID ç”¨æˆ·åŒ¹é…ï¼ˆå·²å®ç°ï¼Œå¾… Roamio å‘é€ unionidï¼‰

---

## ğŸ‰ **é›†æˆæˆåŠŸçš„è¯æ®**

### **å·²åŒæ­¥çš„äº‹ä»¶**ï¼š

```
äº‹ä»¶ 1:
  ID: 1
  æ ‡é¢˜: 123
  æ¥æº: roamio âœ…
  æ—¶é—´: 2025-11-16 03:37:00

äº‹ä»¶ 2:
  ID: 2
  æ ‡é¢˜: Hi Ralendar!
  æ¥æº: roamio âœ…
  æ—¶é—´: 2025-11-09 11:40:00
```

### **API æ—¥å¿—**ï¼š
```
[11:26:06] POST /api/v1/fusion/events/batch/ â†’ 201 Created
[11:27:09] POST /api/v1/fusion/events/batch/ â†’ 201 Created
```

### **æ•°æ®åº“éªŒè¯**ï¼š
```sql
SELECT COUNT(*) FROM api_event WHERE source_app='roamio';
-- ç»“æœï¼š2 âœ…
```

---

## ğŸ“š **åˆ›å»ºçš„æ–‡æ¡£**

| æ–‡æ¡£ | ç”¨é€” |
|------|------|
| `INTEGRATION_TEST_PLAN.md` | å®Œæ•´æµ‹è¯•æ–¹æ¡ˆ |
| `API_ENDPOINT_CORRECTION.md` | API ç«¯ç‚¹è¯´æ˜ |
| `INTEGRATION_SUCCESS.md` | é›†æˆæˆåŠŸè®°å½• |
| `UNIONID_MATCHING_GUIDE.md` | UnionID åŒ¹é…æŒ‡å— |
| `AUTH_REQUIREMENT_FOR_EVENTS.md` | ç™»å½•æƒé™è¯´æ˜ |
| `TIMEGRID_VIEW_GUIDE.md` | æ—¶é—´è½´è§†å›¾æŒ‡å— |
| `Day18_SUMMARY_ROAMIO_INTEGRATION_SUCCESS.md` | æœ¬æ–‡æ¡£ |

---

## ğŸ”‘ **æŠ€æœ¯è¦ç‚¹æ€»ç»“**

### **1. OpenID vs UnionID**

```python
# OpenIDï¼šåº”ç”¨ä¸“å±
OpenID = Hash(QQç”¨æˆ· + APP_ID)
# Ralendar å’Œ Roamio çš„ OpenID ä¸åŒ

# UnionIDï¼šè·¨åº”ç”¨é€šç”¨
UnionID = Hash(QQç”¨æˆ· + å¼€å‘è€…è´¦å·)
# Ralendar å’Œ Roamio çš„ UnionID ç›¸åŒï¼
```

### **2. è·¨åº”ç”¨è®¤è¯**

```python
@authentication_classes([])  # ç¦ç”¨ DRF å…¨å±€è®¤è¯
@permission_classes([AllowAny])

def batch_create_events(request):
    # æ‰‹åŠ¨éªŒè¯ Token
    token = AccessToken(token_str)  # SECRET_KEY ç›¸åŒ
    roamio_user_id = token['user_id']
    
    # é€šè¿‡ UnionID åŒ¹é…ç”¨æˆ·
    unionid = data.get('unionid')
    qq_user = QQUser.objects.filter(unionid=unionid).first()
    ralendar_user = qq_user.user  # âœ… ç²¾å‡†åŒ¹é…ï¼
    
    # åˆ›å»ºäº‹ä»¶
    event = serializer.save(user=ralendar_user)
```

### **3. æ ¼å¼å…¼å®¹**

```python
# è‡ªåŠ¨è¯†åˆ«æ ¼å¼
if 'events' in data:
    # æ‰¹é‡æ ¼å¼ï¼š{"events": [...]}
    events_data = data['events']
else:
    # å•äº‹ä»¶æ ¼å¼ï¼š{"title": "...", ...}
    events_data = [data]  # è‡ªåŠ¨åŒ…è£…
```

---

## ğŸ¯ **å½“å‰ç³»ç»Ÿæ¶æ„**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         JWT Token          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Roamio    â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> â”‚  Ralendar   â”‚
â”‚             â”‚                             â”‚             â”‚
â”‚ user_id: 5  â”‚  {                          â”‚ user_id: 2  â”‚
â”‚ openid: F6E5â”‚    "unionid": "X123456789" â”‚ openid: A1B2â”‚
â”‚ unionid: X12â”‚    "events": [...]         â”‚ unionid: X12â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  }                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                    â†“
                                            QQUser.filter(
                                              unionid='X123456789'
                                            ).first().user
                                                    â†“
                                            æ‰¾åˆ°ï¼šuser_id = 2
                                                    â†“
                                            äº‹ä»¶å½’å±äºæ­£ç¡®çš„ç”¨æˆ·ï¼âœ…
```

---

## ğŸ“Š **é›†æˆæµç¨‹**

### **å®Œæ•´çš„äº‹ä»¶åŒæ­¥æµç¨‹**ï¼š

```
Step 1: ç”¨æˆ·åœ¨ Roamio ç”¨ QQ ç™»å½•
    â†’ è…¾è®¯è¿”å›ï¼šopenid_B + unionid_X
    â†’ Roamio ä¿å­˜åˆ° SocialAccount è¡¨

Step 2: ç”¨æˆ·åœ¨ Ralendar ç”¨åŒä¸€ä¸ª QQ ç™»å½•
    â†’ è…¾è®¯è¿”å›ï¼šopenid_A + unionid_X
    â†’ Ralendar ä¿å­˜åˆ° QQUser è¡¨
    â†’ unionid ç›¸åŒï¼å»ºç«‹å…³è”ï¼âœ…

Step 3: ç”¨æˆ·åœ¨ Roamio åˆ›å»ºå¾…åŠ
    â†’ å¡«å†™æ ‡é¢˜ã€æè¿°ã€æ—¶é—´
    â†’ ç‚¹å‡»"åˆ›å»º"

Step 4: Roamio å‰ç«¯ â†’ Roamio åç«¯
    â†’ æ·»åŠ  JWT Token (user_id=5)
    â†’ è·å– unionid = "X123456789"

Step 5: Roamio åç«¯ â†’ Ralendar API
    POST /api/v1/fusion/events/batch/
    Authorization: Bearer TOKEN
    {
      "unionid": "X123456789",
      "events": [{
        "title": "æµ‹è¯•",
        "start_time": "2025-11-20T10:00:00+08:00"
      }]
    }

Step 6: Ralendar éªŒè¯å’Œå¤„ç†
    â†’ éªŒè¯ Token âœ… (SECRET_KEY ç›¸åŒ)
    â†’ æŸ¥æ‰¾ unionid âœ…
        SELECT * FROM api_qquser WHERE unionid='X123456789'
        æ‰¾åˆ°ï¼šuser_id = 2
    â†’ è·å–ç”¨æˆ· âœ…
        SELECT * FROM auth_user WHERE id=2
        æ‰¾åˆ°ï¼šW à«§ H
    â†’ åˆ›å»ºäº‹ä»¶ âœ…
        INSERT INTO api_event (user_id, title, ...)
        VALUES (2, 'æµ‹è¯•', ...)

Step 7: Ralendar è¿”å›å“åº”
    201 Created
    {
      "success": true,
      "created_count": 1,
      "events": [{å®Œæ•´äº‹ä»¶æ•°æ®}]
    }

Step 8: ç”¨æˆ·åœ¨ Ralendar æŸ¥çœ‹æ—¥å†
    â†’ ç™»å½• Ralendar
    â†’ æŸ¥çœ‹æ—¥å†
    â†’ âœ… çœ‹åˆ°ä» Roamio åŒæ­¥çš„äº‹ä»¶ï¼
```

---

## ğŸŠ **é›†æˆç»“æœ**

### **å·²åˆ›å»ºçš„äº‹ä»¶**ï¼š

| ID | æ ‡é¢˜ | æ—¶é—´ | æ¥æº | ç”¨æˆ· |
|----|------|------|------|------|
| 1 | 123 | 2025-11-16 03:37 | roamio âœ… | anonymous |
| 2 | Hi Ralendar! | 2025-11-09 11:40 | roamio âœ… | anonymous |

**è¯´æ˜**ï¼š
- âœ… äº‹ä»¶æˆåŠŸä» Roamio åŒæ­¥åˆ° Ralendar
- âš ï¸ å½“å‰å½’å±äº anonymousï¼ˆå› ä¸º Roamio è¿˜æ²¡å‘é€ unionidï¼‰
- ğŸ¯ Roamio æ·»åŠ  unionid åï¼Œä¼šå½’å±äºæ­£ç¡®ç”¨æˆ·

---

## ğŸ”§ **å…³é”®æŠ€æœ¯å®ç°**

### **1. è·¨åº”ç”¨è®¤è¯ç»•è¿‡**

**é—®é¢˜**ï¼š
```
Roamio Token ä¸­çš„ user_id = 5
åœ¨ Ralendar æ•°æ®åº“ä¸­ä¸å­˜åœ¨
    â†“
DRF å…¨å±€è®¤è¯å¤±è´¥ â†’ 401
```

**è§£å†³**ï¼š
```python
@authentication_classes([])  # ç¦ç”¨å…¨å±€è®¤è¯
@permission_classes([AllowAny])

# æ‰‹åŠ¨éªŒè¯ Tokenï¼Œä¸ä¾èµ– user_id å­˜åœ¨
token = AccessToken(token_str)  # åªè¦ SECRET_KEY ç›¸åŒå°±èƒ½éªŒè¯
```

---

### **2. ç”¨æˆ·åŒ¹é…ä¸‰å±‚ç­–ç•¥**

```python
# ç­–ç•¥ 1ï¼šUnionIDï¼ˆ100% å‡†ç¡®ï¼‰
if unionid:
    qq_user = QQUser.objects.filter(unionid=unionid).first()
    if qq_user:
        return qq_user.user  # âœ…

# ç­–ç•¥ 2ï¼šuser_idï¼ˆç¢°è¿æ°”ï¼‰
try:
    return User.objects.get(id=roamio_user_id)
except User.DoesNotExist:
    pass

# ç­–ç•¥ 3ï¼šé»˜è®¤ç”¨æˆ·ï¼ˆå…œåº•ï¼‰
return User.objects.first()  # anonymous
```

---

### **3. Serializer çš„æ­£ç¡®ç”¨æ³•**

**é”™è¯¯åšæ³•** âŒï¼š
```python
event_data['user'] = user.id
serializer = EventSerializer(data=event_data)
event = serializer.save()  # user_id = Noneï¼
```

**æ­£ç¡®åšæ³•** âœ…ï¼š
```python
# ä¸åœ¨ data ä¸­è®¾ç½® user
serializer = EventSerializer(data=event_data)
event = serializer.save(user=user)  # åœ¨ save() æ—¶ä¼ é€’ï¼
```

---

## ğŸ“ˆ **æˆæœç»Ÿè®¡**

### **ä»£ç æäº¤**ï¼š
- ğŸ“ ä»Šå¤©çš„ commitsï¼š20+
- ğŸ“¦ æ–°å¢æ–‡ä»¶ï¼š7ä¸ªæ–‡æ¡£
- ğŸ”§ ä¿®æ”¹æ–‡ä»¶ï¼š15ä¸ª
- ğŸ“ ä»£ç è¡Œæ•°ï¼š1000+ è¡Œ

### **åŠŸèƒ½å®Œæˆåº¦**ï¼š
- ç™»å½•æƒé™ï¼š100% âœ…
- UI ä¼˜åŒ–ï¼š100% âœ…
- æ—¶é—´è½´è§†å›¾ï¼š100% âœ…
- Roamio é›†æˆï¼š95% âœ…ï¼ˆå¾… Roamio å‘é€ unionidï¼‰

---

## ğŸ¯ **å‰©ä½™å·¥ä½œ**

### **Roamio å›¢é˜Ÿéœ€è¦åš**ï¼š
1. åœ¨è¯·æ±‚ä¸­æ·»åŠ  `unionid` å­—æ®µ
2. æˆ–åœ¨ JWT Token ä¸­åŒ…å« `unionid`

**ä»£ç ç¤ºä¾‹**ï¼š
```python
# backend/utils/ralendar_client.py
def batch_create_events(self, user_token, events_list, trip_slug):
    # è·å–å½“å‰ç”¨æˆ·çš„ unionid
    social = SocialAccount.objects.filter(
        user=request.user,
        provider='qq'
    ).first()
    
    data = {
        "source_app": "roamio",
        "unionid": social.unionid if social else '',  # â† æ·»åŠ è¿™ä¸ªï¼
        "related_trip_slug": trip_slug,
        "events": events_list
    }
    
    # è°ƒç”¨ Ralendar API
    response = requests.post(url, json=data, headers=headers)
    return response.json()
```

---

### **Ralendar å›¢é˜Ÿï¼ˆæˆ‘ä»¬ï¼‰**ï¼š
1. âœ… UnionID åŒ¹é…å·²å®ç°
2. â³ ç­‰å¾… Roamio å‘é€ unionid
3. â³ éƒ¨ç½²æœ€æ–°ä»£ç 
4. â³ æµ‹è¯•å®Œæ•´æµç¨‹

---

## ğŸŠ **ä»Šå¤©çš„äº®ç‚¹**

### **1. å¿«é€Ÿå“åº”** âš¡
```
æ”¶åˆ° Roamio æŠ¥å‘Š â†’ ç«‹å³å¼€å§‹å¯¹æ¥
å‘ç°é—®é¢˜ â†’ 5åˆ†é’Ÿå†…ä¿®å¤
æ¯æ¬¡æµ‹è¯• â†’ å®æ—¶ç›‘æ§å’Œè°ƒè¯•
```

### **2. ç³»ç»Ÿæ€è€ƒ** ğŸ§ 
```
ä¸åªæ˜¯ä¿® bugï¼Œè€Œæ˜¯ï¼š
- ç†è§£æ ¹æœ¬åŸå› 
- è®¾è®¡å…¼å®¹æ–¹æ¡ˆ
- è€ƒè™‘æœªæ¥æ‰©å±•
- å®Œå–„æ–‡æ¡£è¯´æ˜
```

### **3. å›¢é˜Ÿåä½œ** ğŸ¤
```
Ralendarï¼šå¿«é€Ÿå“åº”ï¼ŒæŒç»­ä¼˜åŒ–
Roamioï¼šç§¯ææµ‹è¯•ï¼Œè¯¦ç»†åé¦ˆ
åŒæ–¹ï¼šå®Œç¾é…åˆï¼Œå…±åŒè§£å†³é—®é¢˜
```

---

## ğŸŒŸ **å…³é”®å­¦ä¹ **

### **OpenID å’Œ UnionID çš„æœ¬è´¨**

```
OpenID = Hash(ç”¨æˆ· + åº”ç”¨)
  â†’ æ¯ä¸ªåº”ç”¨éƒ½ä¸åŒ
  â†’ ç”¨äºåº”ç”¨å†…ç”¨æˆ·è¯†åˆ«
  â†’ æ— æ³•è·¨åº”ç”¨

UnionID = Hash(ç”¨æˆ· + å¼€å‘è€…)
  â†’ åŒä¸€å¼€å‘è€…çš„æ‰€æœ‰åº”ç”¨éƒ½ç›¸åŒ
  â†’ ç”¨äºè·¨åº”ç”¨ç”¨æˆ·è¯†åˆ«
  â†’ å®Œç¾ï¼âœ…
```

**è¿™æ˜¯è…¾è®¯ä¸“é—¨ä¸ºè·¨åº”ç”¨åœºæ™¯è®¾è®¡çš„æ–¹æ¡ˆï¼**

---

## ğŸ¯ **ä¸‹ä¸€æ­¥è®¡åˆ’**

### **çŸ­æœŸ**ï¼ˆä»Šå¤©ä¸‹åˆï¼‰ï¼š
- [ ] éƒ¨ç½²æœ€æ–°ä»£ç ï¼ˆUnionID åŒ¹é…ï¼‰
- [ ] è½¬ç§»ç°æœ‰äº‹ä»¶åˆ°æ­£ç¡®ç”¨æˆ·
- [ ] ç­‰å¾… Roamio æ·»åŠ  unionid
- [ ] å®Œæ•´æµç¨‹æµ‹è¯•

### **ä¸­æœŸ**ï¼ˆæœ¬å‘¨ï¼‰ï¼š
- [ ] æµ‹è¯•æ—…è¡Œè®¡åˆ’æ‰¹é‡åŒæ­¥
- [ ] ä¼˜åŒ–ç”¨æˆ·ä½“éªŒ
- [ ] å®Œå–„é”™è¯¯å¤„ç†
- [ ] æ€§èƒ½ä¼˜åŒ–

### **é•¿æœŸ**ï¼š
- [ ] æ”¯æŒæ›´å¤šåŒæ­¥åœºæ™¯
- [ ] å®æ—¶åŒæ­¥
- [ ] å†²çªå¤„ç†

---

## ğŸ’¯ **æˆå°±è§£é”**

- ğŸ† è·¨åº”ç”¨é›†æˆä¸“å®¶
- ğŸ” JWT Token äº’è®¤å¤§å¸ˆ
- ğŸ”— UnionID åŒ¹é…å…ˆé©±
- ğŸ› å¿«é€Ÿè°ƒè¯•é«˜æ‰‹
- ğŸ“ æ–‡æ¡£ç¼–å†™èƒ½æ‰‹
- ğŸ¤ å›¢é˜Ÿåä½œæ ‡å…µ

---

## ğŸ‰ **æ€»ç»“**

**ä»Šå¤©ä»æ—©ä¸Š 9 ç‚¹åˆ°ç°åœ¨ï¼ˆ3 å°æ—¶ï¼‰**ï¼š
- âœ… å®Œæˆäº†ç™»å½•æƒé™ç³»ç»Ÿ
- âœ… ä¼˜åŒ–äº† UI/UX ä½“éªŒ
- âœ… å®ç°äº†æ—¶é—´è½´è§†å›¾
- âœ… **æ‰“é€šäº† Ralendar Ã— Roamio é›†æˆ**
- âœ… å®ç°äº† UnionID ç”¨æˆ·åŒ¹é…
- âœ… åˆ›å»ºäº†å®Œæ•´çš„æ–‡æ¡£

**è´¨é‡é«˜ï¼Œé€Ÿåº¦å¿«ï¼Œå›¢é˜Ÿé…åˆå®Œç¾ï¼** ğŸ‘

---

**Ralendar Ã— Roamio é›†æˆæˆåŠŸï¼** ğŸŠğŸ‰ğŸš€

---

**ppshuX & Ralendar Team**  
**2025-11-09 12:00**

